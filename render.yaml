# Render.com Blueprint for SilverCare Full Stack Deployment
# Advanced Feature C & D: Cloud Deployment with Docker orchestration

databases:
  # PostgreSQL Database (Shared by both apps)
  - name: silvercare-db
    databaseName: silvercare
    plan: free
    region: singapore

services:
  # Spring Boot REST API (B2B Service)
  - type: web
    name: silvercare-api
    env: docker
    region: singapore
    plan: free
    dockerfilePath: ./silvercare-api/Dockerfile
    dockerContext: ./silvercare-api
    envVars:
      - key: DB_URL
        fromDatabase:
          name: silvercare-db
          property: connectionString
      - key: DB_USER
        fromDatabase:
          name: silvercare-db
          property: user
      - key: DB_PASSWORD
        fromDatabase:
          name: silvercare-db
          property: password
      - key: STRIPE_SECRET_KEY
        sync: false  # Set manually in Render dashboard
      - key: STRIPE_PUBLISHABLE_KEY
        sync: false
      - key: STRIPE_WEBHOOK_SECRET
        sync: false
      - key: CLIENT_URL
        value: https://silvercare-web.onrender.com
    healthCheckPath: /s-api/status

  # Tomcat Web Application (Main Website - MVC)
  - type: web
    name: silvercare-web
    env: docker
    region: singapore
    plan: free
    dockerfilePath: ./silvercare-web/Dockerfile
    dockerContext: ./silvercare-web
    envVars:
      - key: DB_URL
        fromDatabase:
          name: silvercare-db
          property: connectionString
      - key: DB_USER
        fromDatabase:
          name: silvercare-db
          property: user
      - key: DB_PASSWORD
        fromDatabase:
          name: silvercare-db
          property: password
      - key: API_BASE_URL
        value: https://silvercare-api.onrender.com/s-api
      - key: STRIPE_PUBLISHABLE_KEY
        sync: false  # Set manually in Render dashboard
    healthCheckPath: /
